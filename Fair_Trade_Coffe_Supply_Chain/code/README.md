# Project 6: Fair Trade Coffe Supply Chain - Write Up

## 1. Versions and libraries

- **Truffle v5.1.14-nodeLTS.0 (core: 5.1.13)**: used to develop, test and deploy the smart contracts of the "Coffe Supply Chain" Tracker-DApp.
- **Solidity v0.5.16 (solc-js)**: used to write smart contracts.
- **Node v12.16.3**: used for deploying UI to browser (for building network applications).
- **Web3.js v1.2.1**: DApp interaction with local or remote Ethereum node (via HTTP).

## 2. General write-up

**Contract address on Rinkeby Network:** TBD

**Main steps:** 

*1. Define basic architecture for tracking-application via UML diagrams*
By defining dedicated diagrams with respect to the Unified Modeling Language (UML), the various stakeholders and their respective activities ([UML-Activity diagram](../architecture/FTC_UML-activity-diagram.drawio.pdf)), states ([UML-State diagram](../architecture/FTC_UML-state-diagram.drawio.pdf)) and sequences ([UML-Sequence diagram](../architecture/FTC_UML-sequence-diagram.drawio.pdf)) can be visualized in a standardized manner. Additionally, the smart contract structure as key component of a blockchain-based system, can be clarified by defining a [UML-class diagram](../architecture/FTC_UML-class-diagram.drawio.pdf).

In this case the supply chain of coffee shall be established as transparent and traceable as possible, clearly stating the individual rights of the involved stakeholders, being Farmers, Distributors, Retailers and Consumers, as well as the exact steps the coffee undergoes from harvesting to its final consumption by the Consumer.

*2. Write Smart Contracts*
The structure of the smart contracts is divided into three separate "categories", being [coffeeaccesscontrol](https://github.com/patrem98/Udacity-Blockchain-Nanodegree/tree/master/Fair_Trade_Coffe_Supply_Chain/code/contracts/coffeeaccesscontrol), [coffeebase](https://github.com/patrem98/Udacity-Blockchain-Nanodegree/tree/master/Fair_Trade_Coffe_Supply_Chain/code/contracts/coffeebase) and [coffeecore](https://github.com/patrem98/Udacity-Blockchain-Nanodegree/tree/master/Fair_Trade_Coffe_Supply_Chain/code/contracts/coffeecore). While all contracts belonging to the [coffeeaccesscontrol](https://github.com/patrem98/Udacity-Blockchain-Nanodegree/tree/master/Fair_Trade_Coffe_Supply_Chain/code/contracts/coffeeaccesscontrol) deal with the respective rights of the involved stakeholders with regards to the process step in the supply chain, the Ownable.sol contract (belonging to the coffeecore category) deals with the transfer of the contract-ownership of the [SupplyChain.sol](https://github.com/patrem98/Udacity-Blockchain-Nanodegree/tree/master/Fair_Trade_Coffe_Supply_Chain/code/contracts/coffeebase/SupplyChain.sol). The latter being part of the [coffeebase](https://github.com/patrem98/Udacity-Blockchain-Nanodegree/tree/master/Fair_Trade_Coffe_Supply_Chain/code/contracts/coffeebase) category represents the main smart contract relevant for the entire process structure of the supply chain. It comprises of the following main functions:

- harvestItem()
- processItem()
- packItem()
- sellItem()
- buyItem()
- shipItem()
- receiveItem()
- purchaseItem()
- fetchItemBufferOne()
- fetchItemBufferTwo()

These function shall model the most important steps in the supply chain and serve as trackers of each "Coffee-item" that undergoes all process steps from harvesting to being purchased by the consumer. A "Coffee-item" comprises the following attributes:

    struct Item 
    {  
    uint    sku;  // Stock Keeping Unit (SKU)
    uint    upc; // Universal Product Code (UPC), generated by the Farmer, goes on the package, can be verified by the Consumer
    address payable ownerID;  // Metamask-Ethereum address of the current owner as the product moves through 8 stages
    address payable originFarmerID; // Metamask-Ethereum address of the Farmer
    string  originFarmName; // Farmer Name
    string  originFarmInformation;  // Farmer Information
    string  originFarmLatitude; // Farm Latitude
    string  originFarmLongitude;  // Farm Longitude
    uint    productID;  // Product ID potentially a combination of upc + sku
    string  productNotes; // Product Notes
    uint    productPrice; // Product Price
    State   itemState;  // Product State as represented in the enum above
    address payable distributorID;  // Metamask-Ethereum address of the Distributor
    address payable retailerID; // Metamask-Ethereum address of the Retailer
    address payable consumerID; // Metamask-Ethereum address of the Consumer
    }

All the information stated above can be accessed by all stakeholders via the fetchItemBufferOne() and fetchItemBufferTwo() methods.

*3. Test Smart Contracts*
After drafting all relevant smart contracts, it is vital to test them. For this, dedicated tests have been written in the [TestSupplychain.js](https://github.com/patrem98/Udacity-Blockchain-Nanodegree/tree/master/Fair_Trade_Coffe_Supply_Chain/code/test/TestSupplychain.js) file, testing the correct operation principle of the main functions written in the smart contracts, more specifically in the [SupplyChain.sol](https://github.com/patrem98/Udacity-Blockchain-Nanodegree/tree/master/Fair_Trade_Coffe_Supply_Chain/code/contracts/coffeebase/SupplyChain.sol) file. 

For all 10 methods listed above (harvestItem(), processItem(), etc.) a dedicated test has been written in in the truffle testing environment using the "async/await notation" in JavaScript. For detailed information, see file [TestSupplychain.js](https://github.com/patrem98/Udacity-Blockchain-Nanodegree/tree/master/Fair_Trade_Coffe_Supply_Chain/code/test/TestSupplychain.js).

*4. Deploy Smart contracts on a public test network (Rinkeby)*

## 3. UML diagrams

- [Activity diagram](../architecture/FTC_UML-activity-diagram.drawio.pdf)

- [Sequence diagram](../architecture/FTC_UML-sequence-diagram.drawio.pdf)

- [State diagram](../architecture/FTC_UML-state-diagram.drawio.pdf)

- [Class diagram (Data model)](../architecture/FTC_UML-class-diagram.drawio.pdf)

## 4. Future work (optional)

In order to make the established blockchain-based coffee supply chain more sophisticated the following steps are still possible:

- Adding a distributed file storage with the InterPlanetary File System (IPFS)
- Enancing the access control potential of all stakeholders by implementing additional modifiers for the respective functions, so that e.g. a Consumer is not able to put Coffe beans "sellItem()". This bases on the inherited contracts (e.g. [DistributorRole.sol](https://github.com/patrem98/Udacity-Blockchain-Nanodegree/tree/master/Fair_Trade_Coffe_Supply_Chain/code/contracts/coffeeaccesscontrol/DistributorRole.sol)) in the [SupplyChain.sol](https://github.com/patrem98/Udacity-Blockchain-Nanodegree/tree/master/Fair_Trade_Coffe_Supply_Chain/code/contracts/coffeebase/SupplyChain.sol) contract.
- Adding pictures of items or a barcode to scan (a typical feature in standard supply chain), in order to enhance traceability and tracking possibility of every item and further simplify the interaction for the user.
